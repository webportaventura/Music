<head>
<meta charset="UTF-8">
<meta name="robots" content="noindex, nofollow">
<meta name="viewport" content="width=device-width, initial-scale=0.9">
<title>The Warmth Of Christmas</title>
  
<style>
body {
  margin:0;
  padding:0;
  font-family:'Montserrat', sans-serif;
  color:white;
  background:linear-gradient(to bottom,
    rgba(120,40,40,0.55),
    rgba(40,15,15,0.85),
    rgba(15,8,8,1)
  );
  background-attachment:fixed;
}

/* PORTADA + INFO ÁLBUM */
.album {
  max-width:90%;
  margin:20px auto 10px auto;
  padding:0;
}

.cover {
  width:100%;
  max-width:310px;
  border-radius:12px;
  display:block;
  margin:auto;
  box-shadow:0 18px 38px rgba(0,0,0,0.55);
}

.album-info {
  width:55%;
  min-width:340px;
  margin-top:50px;
  margin-bottom:15px;
  margin:10px auto;
  display:flex;
  flex-wrap: wrap;
  justify-content:space-between;
  align-items:center;
  background:transparent;
}

.album-text {
  text-align:left;
  
}

.album-title {
  font-size:150%;
  font-weight:700;
    margin-bottom:8px;
}

.album-year {
  font-size:90%;
  color:white;
  
  margin-bottom:4px;
}

.album-count {
  font-size:90%;
  color:#ccc;
}

/* BOTÓN REPRODUCIR TODO */
.playall-btn {
  white-space: nowrap;
  flex-shrink: 1;
  display:flex;
  align-items:center;
  gap:5px;
  padding:10px 15px;
  border-radius:40px;
  border:none;
  cursor:pointer;
  color:white;
  font-weight:600;
  font-size:70%;
  background:linear-gradient(135deg, #552222, #221111);
  box-shadow:0 6px 14px rgba(0,0,0,0.45);
  }


.playall-btn svg {
  width:20px;
  height:20px;
  fill:white;
}

/* LISTADO DE CANCIONES */
.track {
  display:flex;
  align-items:center;
  padding:5px 8px;
  margin:10px auto;
  width:60%;
  min-width:340px;
  border-radius:0;
  cursor:pointer;
  border:1px solid rgba(255,255,255,0.08);
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,0.02),
    rgba(255,255,255,0.11)
  );
}

.track:hover {
  background:linear-gradient(
    to bottom,
    rgba(255,255,255,0.03),
    rgba(255,255,255,0.15)
  );
}

.track-info {
  display:flex;
  align-items:center;
  gap:10px;
  flex:1;
}

.track img {
  width:55px;
  height:55px;
  border-radius:6px;
  object-fit:cover;
  box-shadow:0 6px 14px rgba(0,0,0,0.55);
}

.track-title {
  font-weight:600;
  font-size:95%;
  margin-bottom:4px;
}

.track-sub {
  font-size:80%;
  color:#ccc;
}

.track-duration {
  font-size:80%;
  color:white;
  margin-right:10px;
}

/* BOTÓN DESCARGA A */
.download-btn {
  width:36px;
  height:36px;
  display:flex;
  align-items:center;
  justify-content:center;
  background:transparent;
  border:none;
  cursor:pointer;
}

.download-btn svg {
  width:26px;
  height:26px;
  stroke:white;
  stroke-width:2;
  fill:none;
}

/* MINI‑PLAYER */
#floating-player {
  position:fixed;
  bottom:-100%;
  left:0;
  width:100%;
  background:rgba(0,0,0,0.4);
  backdrop-filter:blur(14px);
  padding:16px;
  box-sizing:border-box;
  border-top:1px solid rgba(255,255,255,0.1);
  transition:bottom .35s ease;
  z-index:999;
}

  /* Flecha colapso centrada */
#fp-collapse {
  background:transparent;
  border:none;
  cursor:pointer;
  padding:4px;
  position:absolute;
  top:4px;
  left:50%;
  transform:translateX(-50%);
  display:none;
}

  #fp-collapse svg {
  width:26px;
  height:26px;
  stroke:white;
  stroke-width:2;
  fill:none;
}

  /* Botón cerrar */
#fp-close {
  position:absolute;
  right:8px;
  top:8px;
  background:transparent;
  border:none;
  color:white;
  font-size:20px;
  cursor:pointer;
}

.fp-content {
  display:flex;
  align-items:center;
  gap:14px;
  margin-top:20px;
}

  /* Portada mini-player */
#fp-cover {
  width:130px;
  height:130px;
  border-radius:8px;
  object-fit:cover;
  box-shadow:0 6px 14px rgba(0,0,0,0.55);
}

.fp-text {
  flex:1;
  text-align:left;
}

#fp-title {
  font-weight:700;
  font-size:16px;
  margin-bottom:4px;
}

.fp-sub1,
.fp-sub2,
.fp-sub3 {
  font-size:80%;
  color:#ccc;
  margin-bottom:2px;
}

/* CONTROLES */
.fp-controls-row {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:35px;
  margin-top:12px;
}

.fp-btn {
  background:transparent;
  border:none;
  cursor:pointer;
}

.fp-btn svg {
  width:26px;
  height:26px;
  fill:white;
  opacity:0.9;
}

.fp-btn.toggle.active svg {
  fill:#ffd966;
  stroke:#ffd966;
  opacity:1;
}

/* PLAY CON CÍRCULO OSCURO */
.fp-play-circle {
  width:58px;
  height:58px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:linear-gradient(135deg, #331515, #110707);
  box-shadow:0 6px 14px rgba(0,0,0,0.65);
}

.fp-play-circle svg {
  width:28px;
  height:28px;
  fill:white;
}

/* PROGRESO */
#fp-progress-container {
  width:100%;
  height:8px;
  background:rgba(255,255,255,0.12);
  border-radius:4px;
  margin-top:14px;
  position:relative;
  cursor:pointer;
}

#fp-progress {
  height:100%;
  width:0%;
  background:rgba(255,255,255,0.8);
}

#fp-progress-thumb {
  position:absolute;
  top:50%;
  left:0%;
  transform:translate(-50%, -50%);
  width:12px;
  height:12px;
  background:white;
  border-radius:50%;
}

/* EXPANDIDO */
#floating-player.expanded {
  height:78vh;
  border-radius:20px 20px 0 0;
  padding-top:40px;
}

#floating-player.expanded #fp-collapse {
  display:block;
}

#floating-player.expanded .fp-content {
  flex-direction:column;
  align-items:center;
  text-align:center;
}

  /* Portada expandida */
#floating-player.expanded #fp-cover {
  width:300px;
  height:300px;
  margin-bottom:10px;
}

#floating-player.expanded .fp-text {
  text-align:center;
}

#floating-player.expanded .fp-controls-row {
  margin-top:20px;
}

#floating-player.expanded #fp-progress-container {
  margin-top:20px;
}

  /* Animaciones título */
.fp-title-exit-left { animation:exitLeft .35s forwards; }
.fp-title-enter-left { animation:enterLeft .35s forwards; }
.fp-title-exit-right { animation:exitRight .35s forwards; }
.fp-title-enter-right { animation:enterRight .35s forwards; }

@keyframes exitLeft { from{opacity:1;transform:translateX(0);} to{opacity:0;transform:translateX(-30px);} }
@keyframes enterLeft { from{opacity:0;transform:translateX(30px);} to{opacity:1;transform:translateX(0);} }
@keyframes exitRight { from{opacity:1;transform:translateX(0);} to{opacity:0;transform:translateX(30px);} }
@keyframes enterRight { from{opacity:0;transform:translateX(-30px);} to{opacity:1;transform:translateX(0);} }

  .bottom-spacer {
  height:260px;
}
  
</style>
</head>






<body>

<div class="album">
  <img class="cover" src="../img/portadaWarmthOfChristmas.png">

  <div class="album-info">
    <div class="album-text">
      <div class="album-title">The Warmth Of Christmas</div>
      <div class="album-year">2025</div>
      <div class="album-count">8 canciones, 20min 57s</div>
    </div>

    <button id="play-all" class="playall-btn">
      <svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
      Reproducir todo
    </button>
  </div>
</div>

<!-- LISTADO -->
<div class="track" data-file="01._So_This_Is_Christmas.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">So This Is Christmas</div>
               <div class="track-sub">So This Is Christmas</div>
    </div>   </div>  <div class="track-duration">01:27</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/01.So.This.Is.Christmas.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

<div class="track" data-file="02.%20The%20Warmth%20Of%20Christmas.MP3" data-cover="../img/portadaWarmthOfChristmas.png">
  <div class="track-info">
    <img src="../img/portadaWarmthOfChristmas.png">
    <div>
      <div class="track-title">The Warmth Of Christmas</div>
      <div class="track-sub">Canción principal del espectáculo</div>
    </div>
  </div>

  <div class="track-duration">02:10</div>

  <a class="download-btn"  href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/02.The.Warmth.Of.Christmas.MP3" 
        download  onclick="event.stopPropagation()">
    <svg viewBox="0 0 24 24">
      <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>
    </svg>
  </a>
</div>

  <div class="track" data-file="03.%20Deck%20The%20Home%20For%20Christmas.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">Deck The Home For Christmas</div>
               <div class="track-sub">Count On Christmas-Home For The Holidays-Deck The Halls-Holly Jolly Christmas</div>
    </div>   </div>  <div class="track-duration">03:07</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/03.Deck.The.Home.For.Christmas.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

  <div class="track" data-file="04.%20Cold%20Outside%20But%20Warmer%20At%20Home.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">Cold Outside But Warmer At Home</div>
               <div class="track-sub">Warmer In The Winter-Baby, It's Cold Outside</div>
    </div>   </div>  <div class="track-duration">01:52</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/04.Cold.Outside.But.Warmer.At.Home.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

  <div class="track" data-file="05.%20We%20Three%20Gentlemen%20(Lindsey%20Stirling).MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">We Three Gentlemen</div>
               <div class="track-sub">We Three Gentlemen (Lindsey Stirling)</div>
    </div>   </div>  <div class="track-duration">02:58</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/05.We.Three.Gentlemen.Lindsey.Stirling.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

  <div class="track" data-file="06.%20Santa's%20Coming%20Town%20For%20Us.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">Santa's Coming Town For Us</div>
               <div class="track-sub">Santa Claus Is Coming To Town-Santa's Coming For Us</div>
    </div>   </div>  <div class="track-duration">01:43</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/06.Santa.s.Coming.Town.For.Us.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

  <div class="track" data-file="07.%20Christmas%20Power.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">Christmas Power</div>
               <div class="track-sub">You Make It Feel Like Christmas-Here Comes Santa Claus-Santa Tell Me-We Need A Little Christmas-Jingle Bells</div>
    </div>   </div>  <div class="track-duration">03:36</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/07.Christmas.Power.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

  <div class="track" data-file="08.%20The%20Nutcracker's%20Little%20Drummer.MP3" data-cover="../img/portadaWarmthOfChristmas.png">  <div class="track-info">
               <img src="../img/portadaWarmthOfChristmas.png">
    <div>    <div class="track-title">The Nutcracker's Little Drummer</div>
               <div class="track-sub">March-Drummer Boy-Mother Ginger-Sugarplum Fairy-Candy Cane (The Nutcracker)</div>
    </div>   </div>  <div class="track-duration">04:01</div>
  <a class="download-btn" href="https://github.com/private-audio-shows-51q8/Music/releases/download/warmth_of_christmas/08.The.Nutcracker.s.Little.Drummer.MP3" 
        download onclick="event.stopPropagation()"> <svg viewBox="0 0 24 24"> <path d="M12 3v12m0 0l-5-5m5 5l5-5" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M5 19h14" stroke-linecap="round"/>    </svg>  </a>  </div>

<!-- MINI‑PLAYER -->
<div id="floating-player">

  <button id="fp-collapse">
    <svg viewBox="0 0 24 24">
      <path d="M6 9l6 6 6-6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round"/>
    </svg>
  </button>

  <button id="fp-close">✕</button>

  <div class="fp-content">
    <img id="fp-cover" src="../img/portadaWarmthOfChristmas.png">

<div class="fp-text">
  <div id="fp-anim">
    <div id="fp-title">Reproduciendo...</div>
    <div class="fp-sub2"></div>
    <div class="fp-sub3"></div>
    <div class="fp-sub1">Álbum: The Warmth Of Christmas (2025)</div>
  </div>
</div>

  </div>

  <div class="fp-controls-row">

<button id="fp-shuffle" class="fp-btn toggle">
  <svg viewBox="0 0 24 24" stroke="white" stroke-width="2" fill="none" stroke-linecap="round">
    <path d="M4 4c5 0 7 5 10 10s5 6 6 6"/>
    <path d="M20 4l-4 4 4 4"/>
    <path d="M4 20l4-4-4-4"/>
  </svg>
</button>

    <button id="fp-prev" class="fp-btn">
      <svg viewBox="0 0 24 24"><path d="M6 5v14h2V5H6zm3 7l8 7V5l-8 7z"/></svg>
    </button>

    <button id="fp-play" class="fp-btn fp-play-circle">
      <svg id="fp-play-icon" viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg>
    </button>

    <button id="fp-next" class="fp-btn">
      <svg viewBox="0 0 24 24"><path d="M16 5v14h-2V5h2zM6 5v14l8-7L6 5z"/></svg>
    </button>

    <button id="fp-repeat" class="fp-btn toggle">
      <svg viewBox="0 0 24 24">
        <path d="M7 7h9v2l3-3-3-3v2H6a3 3 0 0 0-3 3v4h2V8a1 1 0 0 1 1-1zm10 10H8v-2l-3 3 3 3v-2h10a3 3 0 0 0 3-3v-4h-2v4a1 1 0 0 1-1 1z"/>
      </svg>
    </button>

  </div>

  <audio id="player"></audio>

  <div id="fp-progress-container">
    <div id="fp-progress"></div>
    <div id="fp-progress-thumb"></div>
  </div>

</div>

<div class="bottom-spacer"></div>

</body>





<script>
  /* ============================
   CONFIGURACIÓN POR ÁLBUM
   ============================ */
const audioBasePath = "../audio/Warmth_Of_Christmas/";
const defaultCover  = "../img/portadaWarmthOfChristmas.png";

  /* ============================
   VARIABLES
   ============================ */
const trackElements = Array.from(document.querySelectorAll(".track"));
let currentIndex = -1;
let repeat = false;
let shuffle = false;
let isDraggingProgress = false;

const player = document.getElementById("player");
const floatingPlayer = document.getElementById("floating-player");
const fpTitle = document.getElementById("fp-title");
const fpCover = document.getElementById("fp-cover");
const fpPlayBtn = document.getElementById("fp-play");
const fpPlayIcon = document.getElementById("fp-play-icon");
const fpRepeatBtn = document.getElementById("fp-repeat");
const fpShuffleBtn = document.getElementById("fp-shuffle");
const fpProgress = document.getElementById("fp-progress");
const fpProgressThumb = document.getElementById("fp-progress-thumb");
const fpProgressContainer = document.getElementById("fp-progress-container");
const fpCollapse = document.getElementById("fp-collapse");
const fpClose = document.getElementById("fp-close");

const fpSub2 = document.querySelector(".fp-sub2");
const fpSub3 = document.querySelector(".fp-sub3");

const playAllBtn = document.getElementById("play-all");

/* CLICK EN CANCIONES */
trackElements.forEach((trackEl, index) => {
  trackEl.addEventListener("click", () => playIndex(index, "forward"));
});


  /* Descargas 
  const releaseBasePath = "https://github.com/private-audio-shows-51q8/Music/tag/warmth_of_christmas/releases/download/v1.0/";

trackElements.forEach((trackEl) => {
  const file = trackEl.dataset.file;
  const downloadBtn = trackEl.querySelector(".download-btn");

  downloadBtn.href = releaseBasePath + file;
  downloadBtn.setAttribute("download", "");
});
*/

/* DATOS */
function getTrackData(index){
  const el = trackElements[index];
  return {
    file: el.dataset.file,
    cover: el.dataset.cover || defaultCover,
    title: el.querySelector(".track-title").textContent.trim(),
    contiene: el.querySelector(".track-sub").textContent.trim(),
    duracion: el.querySelector(".track-duration").textContent.trim()
  };
}

/* REPRODUCIR */
function playIndex(index, direction="forward"){
  currentIndex = index;
  const track = getTrackData(index);

  fpCover.src = track.cover;

animateBlock(direction, {
  title: track.title,
  contiene: track.contiene,
  duracion: track.duracion
});


  player.src = audioBasePath + track.file;
  player.play();
  updatePlayIcon(true);

  setDynamicGradient(track.cover);

  floatingPlayer.style.bottom = "0px";
}

  /* Animación del título */
  function animateBlock(direction, newData){
  const block = document.getElementById("fp-anim");

  block.classList.remove(
    "fp-title-enter-left","fp-title-exit-left",
    "fp-title-enter-right","fp-title-exit-right"
  );

  block.classList.add(
    direction === "backward" ? "fp-title-exit-right" : "fp-title-exit-left"
  );

  setTimeout(() => {

    fpTitle.textContent = newData.title;
    fpSub2.textContent = newData.contiene;
    fpSub3.textContent = "Duración: " + newData.duracion;

    block.classList.remove(
      "fp-title-enter-left","fp-title-exit-left",
      "fp-title-enter-right","fp-title-exit-right"
    );

    block.classList.add(
      direction === "backward" ? "fp-title-enter-right" : "fp-title-enter-left"
    );

  }, 200);
}


/* BOTÓN REPRODUCIR TODO */
playAllBtn.addEventListener("click", () => {
  playIndex(0, "forward");
});

/* CERRAR */
fpClose.addEventListener("click", () => {
  player.pause();
  floatingPlayer.style.bottom = `-${floatingPlayer.offsetHeight}px`;
});

/* COLAPSAR */
fpCollapse.addEventListener("click", (e) => {
  e.stopPropagation();
  floatingPlayer.classList.remove("expanded");
});

/* OSCURECER COLOR */
function darkenColor(r,g,b,amount){
  return `rgba(${Math.floor(r*amount)}, ${Math.floor(g*amount)}, ${Math.floor(b*amount)}, 1)`;
}

/* GRADIENTE DINÁMICO */
function setDynamicGradient(imageSrc){
  const img = new Image();
  img.crossOrigin = "anonymous";
  img.src = imageSrc;

  img.onload = function(){
    const canvas = document.createElement("canvas");
    const ctx = canvas.getContext("2d");

    canvas.width = img.width;
    canvas.height = img.height;
    ctx.drawImage(img, 0, 0);

   const c = ctx.getImageData(img.width/2, img.height/2, 1, 1).data;

      const c1 = ctx.getImageData(10, 10, 1, 1).data;
      const c2 = ctx.getImageData(img.width/2, img.height/2, 1, 1).data;
      const c3 = ctx.getImageData(img.width-10, img.height-10, 1, 1).data;

      const col1 = `rgba(${c1[0]}, ${c1[1]}, ${c1[2]}, 0.6)`;
      const col2 = `rgba(${c2[0]}, ${c2[1]}, ${c2[2]}, 0.6)`;
      const col3 = `rgba(${c3[0]}, ${c3[1]}, ${c3[2]}, 0.6)`;

    const dark1 = darkenColor(c[0], c[1], c[2], 0.90);
    const dark2 = darkenColor(c[0], c[1], c[2], 0.90);

    const mid1  = darkenColor(c[0], c[1], c[2], 0.55);
    const mid2  = darkenColor(c[0], c[1], c[2], 0.35);

    floatingPlayer.style.background =
      `linear-gradient(135deg, ${col1}, ${col2}, ${col3})`;

    document.querySelector(".fp-play-circle").style.background =
      `linear-gradient(135deg, ${dark1}, ${dark2})`;

    playAllBtn.style.background =
      `linear-gradient(135deg, ${mid1}, ${mid2})`;
  };
}

/* PROGRESO */
player.addEventListener("timeupdate", () => {
  if (!player.duration || isDraggingProgress) return;
  const percent = (player.currentTime / player.duration) * 100;
  fpProgress.style.width = percent + "%";
  fpProgressThumb.style.left = percent + "%";
});

function seekFromClientX(clientX){
  const rect = fpProgressContainer.getBoundingClientRect();
  let x = clientX - rect.left;
  x = Math.max(0, Math.min(rect.width, x));
  const percent = x / rect.width;

  if (player.duration) {
    player.currentTime = percent * player.duration;
  }

  const percent100 = percent * 100;
  fpProgress.style.width = percent100 + "%";
  fpProgressThumb.style.left = percent100 + "%";
}

fpProgressContainer.addEventListener("mousedown", (e) => {
  e.stopPropagation();
  isDraggingProgress = true;
  seekFromClientX(e.clientX);
});

document.addEventListener("mousemove", (e) => {
  if (!isDraggingProgress) return;
  seekFromClientX(e.clientX);
});

document.addEventListener("mouseup", () => {
  isDraggingProgress = false;
});

/* Touch */
fpProgressContainer.addEventListener("touchstart", (e) => {
  e.stopPropagation();
  isDraggingProgress = true;
  seekFromClientX(e.touches[0].clientX);
}, {passive:true});

document.addEventListener("touchmove", (e) => {
  if (!isDraggingProgress) return;
  seekFromClientX(e.touches[0].clientX);
}, {passive:true});

document.addEventListener("touchend", () => {
  isDraggingProgress = false;
});

/* SIGUIENTE / ANTERIOR */
document.getElementById("fp-next").addEventListener("click", (e) => {
  e.stopPropagation();
  const nextIndex = (currentIndex + 1) % trackElements.length;
  playIndex(nextIndex, "forward");
});

document.getElementById("fp-prev").addEventListener("click", (e) => {
  e.stopPropagation();
  const prevIndex = (currentIndex - 1 + trackElements.length) % trackElements.length;
  playIndex(prevIndex, "backward");
});

/* REPETIR / ALEATORIO */
fpRepeatBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  repeat = !repeat;
  fpRepeatBtn.classList.toggle("active", repeat);
});

fpShuffleBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  shuffle = !shuffle;
  fpShuffleBtn.classList.toggle("active", shuffle);
});

player.addEventListener("ended", () => {
  if (repeat) {
    playIndex(currentIndex, "forward");
    return;
  }
  if (shuffle) {
    const randomIndex = Math.floor(Math.random() * trackElements.length);
    playIndex(randomIndex, "forward");
    return;
  }
  const nextIndex = (currentIndex + 1) % trackElements.length;
  playIndex(nextIndex, "forward");
});

/* PLAY / PAUSA */
fpPlayBtn.addEventListener("click", (e) => {
  e.stopPropagation();
  if (player.paused) {
    player.play();
    updatePlayIcon(true);
  } else {
    player.pause();
    updatePlayIcon(false);
  }
});

function updatePlayIcon(isPlaying){
  if (isPlaying) {
    fpPlayIcon.innerHTML = '<path d="M7 5h3v14H7zM14 5h3v14h-3z"/>';
  } else {
    fpPlayIcon.innerHTML = '<path d="M8 5v14l11-7z"/>';
  }
}

player.addEventListener("play", () => updatePlayIcon(true));
player.addEventListener("pause", () => updatePlayIcon(false));

/* EXPANDIR */
floatingPlayer.addEventListener("click", (e) => {
  if (e.target.closest(".fp-btn") || 
      e.target.closest("#fp-close") || 
      e.target.closest("#fp-collapse") ||
      e.target.closest("#fp-progress-container")) return;

  floatingPlayer.classList.toggle("expanded");
});
</script>
